/*! tedx-amherst-website 12-11-2015 */
var app=angular.module("tedx",["ui.router","ngAnimate","ngTouch","restangular","headroom"]);app.config(function(a,b,c){b.otherwise("/"),a.state("intro",{url:"/",templateUrl:"views/intro.tpl.html",controller:"mainController"}).state("speakers",{url:"/speakers",templateUrl:"views/speakers.tpl.html",controller:"speakerController"}).state("team",{url:"/team/:teamName",templateUrl:"views/team.tpl.html",controller:"teamController"}).state("about",{url:"/about",templateUrl:"views/about.tpl.html",controller:"aboutController"}),c.html5Mode(!0)});var configureLoadingHandler=function(a){a.loading={},a.loading.status=!1,a.loading.start=function(){var a=this;a.status=!0},a.loading.end=function(){clearTimeout(this.timer),this.status=!1}};app.run(function(a,b){configureLoadingHandler(a),a.repoData={},a.$on("$stateChangeSuccess",function(b,c,d,e,f){a.state=c.name,a.nav=!1}),a.$on("$stateChangeStart",function(b){a.loading.start(),window.scrollTo(0,0)})}),app.config(function(a){a.setBaseUrl("/api"),a.addResponseInterceptor(function(a,b,c,d,e,f){return a.data?a.data:a.error?(console.error(a.error),!1):void 0})}),app.controller("aboutController",function(a,b){b.loading.end()}),app.controller("eventController",function(a){}),app.controller("mainController",function(a,b){scrollInit(),particleInit(),b.loading.end()});var scrollInit=function(){var a=new ScrollMagic.Controller;new ScrollMagic.Scene({duration:"100%"}).setTween(".cta",{opacity:0}).addTo(a),new ScrollMagic.Scene({duration:"100%"}).setTween(".arrow_down",{opacity:0,bottom:"200px"}).addTo(a)},particleInit=function(){particlesJS.load("starfield","../assets/particles.json",function(){})};app.controller("speakerController",function(a,b,c){b.repoData.speakers?b.loading.end():c.getSpeakers(!0).then(function(a){a.plain();b.repoData.speakers=pruneSpeakers(a),b.loading.end()})});var pruneSpeakers=function(a){var b=a.plain(),c={};for(var d in b){var e=b[d];void 0!==c[e.year]?c[e.year].push(e):(c[e.year]=[],c[e.year].push(e))}return c};app.controller("teamController",function(a,b,c,d){b.repoData.team={},resolveTeamData(c,b,function(){b.loading.end(),console.log("done!"),a.$broadcast("tabSelected",d.teamName)})});var resolveTeamData=function(a,b,c){return b.repoData.team.teams?c():void a.getTeams(!0).then(function(d){return b.repoData.team={},b.repoData.team.teams=d.plain(),b.repoData.team.teamMembers?c():void a.getTeamMembers(!0).then(function(a){sortMembers(a.plain(),b,function(){return c()})})})},sortMembers=function(a,b,c){var d={},e={};for(var f in a){var g=a[f];d[g.team]?(d[g.team].push(g),e[g.team].push(g.image)):(d[g.team]=[],e[g.team]=[],d[g.team].push(g),e[g.team].push(g.image))}return b.repoData.team.teamMembers=d,b.repoData.team.teamImages=e,c()};app.directive("bgImg",function(){return function(a,b,c){c.$observe("bgImg",function(a){b.css({"background-image":"url("+a+")"})})}}),app.directive("fixedFade",function(){return{restrict:"AE",scope:{parent:"="},controller:function(){},link:function(a,b){console.log(a.parent),console.log($(a.parent).offset());var c=$(a.parent).offset(),d=$(a.parent).height(),e=d/100;b[0].style.opacity=1,testEl=b[0],console.log("element",b[0]),$(window).scroll(function(a){var f=$(window).scrollTop();c>f||f>=c&&c+d>=f&&(b[0].style.opacity=Math.floor((f-c)/e))})}}}),app.directive("mobileMenu",function(){return{restrict:"AE",templateUrl:"views/mobileMenu.tpl.html",controller:function(a,b){b.nav=!1,a.drizzy="drizzy",a.toggleNav=function(){a.nav?b.nav=!1:b.nav=!0}},link:function(a){}}}),app.directive("tab",function(){return{restrict:"E",scope:{tabTitle:"="},transclude:!0,templateUrl:"views/tabGroup/tab.tpl.html",controller:function(a,b){a.current="",a.$on("tabChanged",function(b,c){a.current=c})},link:function(a,b,c){a.$emit("addTab",a.tabTitle)}}}),app.directive("tabGroup",function(){return{restrict:"E",transclude:!0,templateUrl:"views/tabGroup/tabGroup.tpl.html",bindToController:!0,controllerAs:"tabGroup",controller:function(a,b){a.tabs=[],a.current="",a.select=function(b){a.tabs.indexOf(b)>-1&&(a.current=b,a.$broadcast("tabChanged",a.current))},a.$on("tabSelected",function(b,c){console.log("key",c),a.select(c)}),a.$on("addTab",function(b,c){a.tabs.push(c),a.tabs.sort(function(a,b){return b-a}),a.select(a.tabs[0])})},link:function(a,b,c,d,e){}}}),app.directive("tedHeader",function(){return{restrict:"AE",templateUrl:"views/header.tpl.html",controller:function(a,b,c){a.stateControl=c},link:function(a,b,c){switch(b[0].getAttribute("type")){case"solid":a.isSolid=!0;break;case"transparent":a.isSolid=!1;break;case"light_transparent":a.isSolid=!0,a.isTransparent=!0;break;default:a.isSolid=!1}}}}),app.service("api",function(a,b){return{getSpeakers:function(a,c){return promiseHandler(b.all("speaker").getList(),a)},getTeamMembers:function(a,c){return promiseHandler(b.all("teamMember").getList(),a)},getTeams:function(a,c){return promiseHandler(b.all("team").getList(),a)}}});var promiseHandler=function(a,b){return b!==!1?a:void a.then(function(a){return a})};app.service("stateControl",function(a,b){return{toState:function(c){b.loading.timer=setTimeout(function(){b.loading.status=!0,console.log("Loading...")},500),a.go(c)}}});